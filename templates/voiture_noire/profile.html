{% extends './base.html' %}

{% block stylesheet %}
<link rel="stylesheet" href="/static/voiture_noire/profile.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css" />
<script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js"></script>
{% endblock %}

{% block title %}
    Votre profil
{% endblock %}

{% block content %}
<noscript>
    <div class="javascript-warning">
        Ce site requiert javascript pour fonctionner correctement. Désolée !
    </div>
</noscript>

<h1>{{ user.username.capitalize }} | Votre profil</h1>

<hr>

{% if messages %}
    <ul class="error-messages">
        {% for message in messages %}
            <li>{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}

<section>
    <p>Ici, vous pouvez configurer vos goûts afin :</p>
    <p>
        1. de vous faciliter la vie durant les échanges en
         les gardant de côté ;
    </p>
    <p>
         2. de permettre à autrui
        de vous offrir, potentiellement, des dessins ou des fics. 
    </p>
    <p>
        <b>Attention</b> : si vous êtes du genre bavard, sauvegardez bien votre texte avant de le poster,
        au cas où le grand internet mondial le mange au moment de sauvegarder.
    </p>
</section>

<form method="post" class="discord-member-profile form-main">
    {% csrf_token %}
    <label for="id_likes">Vous aimez :</label>
    <div id="editor-container-likes" class="quill-input">
    </div>
    <div hidden>{{ form.likes }}</div>

    <label for="id_dislikes">Vous détestez :</label>
    <div id="editor-container-dislikes" class="quill-input">
    </div>
    <div hidden>{{ form.dislikes }}</div>
    <button type="submit">Valider</button>
</form>

<script>
    let likesValue = `{{ form.likes.value | safe }}`  
    let dislikesValue = `{{ form.dislikes.value | safe }}`  


    let quillLikes = new Quill('#editor-container-likes', {
        modules: {
            toolbar: [
                ['bold', 'italic', 'underline','strike', 'link', { 'list': 'ordered'}, { 'list': 'bullet' }],
            ]
        },
        placeholder: '',
        theme: 'snow'
    });

    /////// SECOND QUILL EDITOR
    let quillDislikes = new Quill('#editor-container-dislikes', {
        modules: {
            toolbar: [
                ['bold', 'italic', 'underline','strike', 'link', { 'list': 'ordered'}, { 'list': 'bullet' }],
            ]
        },
        placeholder: '',
        theme: 'snow'
    });

    ///// UTILS
    quillLikes.on('text-change', function(delta, source) {
        handleCharacterLimit("likes")
	    updateHtmlOutput("likes")
    })
    quillDislikes.on('text-change', function(delta, source) {
        handleCharacterLimit("dislikes")
        updateHtmlOutput("dislikes")
    })

    function updateHtmlOutput(editorName) {
        const quill = editorName == "likes"? quillLikes: quillDislikes
        let html = getQuillHtml(editorName);
        document.getElementById('id_'+editorName).innerText = html;
    }

    function getQuillHtml(editorName) {
        const quill = editorName == "likes"? quillLikes: quillDislikes
        if (editorName == "likes") {
            return quillLikes.root.innerHTML;
        } else {
            return quillDislikes.root.innerHTML;
        }

    }

    quillLikes.clipboard.dangerouslyPasteHTML(likesValue);
    quillDislikes.clipboard.dangerouslyPasteHTML(dislikesValue);


    ////// GENERAL EDITOR FUNCTIONS
    function handleCharacterLimit(editorName) {
        const limit = 3000
        const quill = editorName == "likes"? quillLikes: quillDislikes

        if (quill.getLength() > limit) {
            quill.deleteText(limit, quill.getLength());
        }
    }
</script>
{% endblock %}